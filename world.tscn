[gd_scene load_steps=16 format=4 uid="uid://c6antsn5ngihu"]

[ext_resource type="Texture2D" uid="uid://wi6e3alnmqh0" path="res://sprites/main.png" id="1_f3sb7"]
[ext_resource type="Script" uid="uid://dgq77y7vb1lah" path="res://player.gd" id="2_pkg7o"]
[ext_resource type="Script" uid="uid://ckhvctyix6juc" path="res://crawl.gd" id="2_tlwt5"]
[ext_resource type="Script" uid="uid://dmmbpsi8ggh0o" path="res://jump.gd" id="3_036b0"]
[ext_resource type="Script" uid="uid://b6it1roy42jng" path="res://input_service.gd" id="3_aqk2v"]
[ext_resource type="Script" uid="uid://s78nwwn8edpf" path="res://camera.gd" id="4_036b0"]
[ext_resource type="Script" uid="uid://c2wx4gyeih7p7" path="res://wall_detector.gd" id="4_dwbse"]

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_tlwt5"]
friction = 0.0

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_fj7yv"]
texture = ExtResource("1_f3sb7")
texture_region_size = Vector2i(8, 8)
6:0/0 = 0
6:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
7:0/0 = 0
7:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, -4, 4, 4, -4, 4)
9:3/0 = 0
9:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
10:3/0 = 0
10:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
11:3/0 = 0
11:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
11:4/0 = 0
11:4/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
10:4/0 = 0
10:4/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
9:4/0 = 0
9:4/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
9:5/0 = 0
9:5/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
10:5/0 = 0
10:5/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
11:5/0 = 0
11:5/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
8:4/0 = 0
8:4/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, 4, -4, -4, 4, -4)
7:4/0 = 0
7:4/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4)
7:3/0 = 0
7:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, -4, 4, 4, -4, 4)
8:3/0 = 0
8:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4)
6:3/0 = 0
6:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4, 4, -4)
9:2/0 = 0
9:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
9:1/0 = 0
9:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
10:1/0 = 0
10:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
11:1/0 = 0
11:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
11:2/0 = 0
11:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
10:2/0 = 0
10:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
9:0/0 = 0
9:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
10:0/0 = 0
10:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
11:0/0 = 0
11:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
8:0/0 = 0
8:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(4, 4, -4, 4, -4, -4)
8:1/0 = 0
8:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, -4, 4)
7:1/0 = 0
7:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4)

[sub_resource type="TileSet" id="TileSet_tlwt5"]
tile_size = Vector2i(8, 8)
physics_layer_0/collision_layer = 2
physics_layer_0/collision_mask = 0
physics_layer_0/physics_material = SubResource("PhysicsMaterial_tlwt5")
sources/0 = SubResource("TileSetAtlasSource_fj7yv")

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_f3sb7"]
bounce = 1.0
absorbent = true

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_036b0"]
radius = 3.0
height = 6.0

[sub_resource type="AtlasTexture" id="AtlasTexture_036b0"]
atlas = ExtResource("1_f3sb7")
region = Rect2(0, 80, 16, 16)

[sub_resource type="SpriteFrames" id="SpriteFrames_f3sb7"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_036b0")
}],
"loop": false,
"name": &"idle",
"speed": 5.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_036b0"]
radius = 3.5

[node name="World" type="Node2D"]

[node name="TestTilemap" type="TileMapLayer" parent="."]
texture_filter = 1
tile_map_data = PackedByteArray("AADz//j/AAAKAAAAAAD0//j/AAAKAAAAAAD1//j/AAAKAAAAAAD2//j/AAAKAAAAAAD3//j/AAAKAAAAAAD4//j/AAALAAAAAAD4//n/AAALAAEAAAD4//r/AAALAAEAAAD4//v/AAALAAEAAAD4//z/AAALAAEAAAD4//3/AAALAAEAAAD4//7/AAALAAEAAAD4////AAALAAEAAAD4/wAAAAAKAAEAAAD5/wAAAAAKAAAAAAD6/wAAAAAKAAAAAAD7/wAAAAAKAAAAAAD8//v/AAAHAAAAAAD8//z/AAAHAAEAAAD8/wAAAAAKAAAAAAD9//r/AAAHAAAAAAD9//v/AAAKAAEAAAD9//z/AAAKAAEAAAD9//3/AAAHAAEAAAD9/wAAAAAKAAAAAAD+//r/AAAIAAAAAAD+//v/AAAKAAEAAAD+//z/AAAKAAEAAAD+//3/AAAIAAEAAAD+/wAAAAAKAAAAAAD///v/AAAIAAAAAAD///z/AAAIAAEAAAD//wAAAAAKAAAAAAAAAAAAAAAKAAAAAAABAAAAAAAKAAAAAAACAPj/AAAGAAAAAAACAPz/AAAGAAAAAAACAAAAAAAKAAAAAAADAAAAAAAKAAAAAAAEAPr/AAAGAAAAAAAEAAAAAAAKAAAAAAAFAAAAAAAKAAAAAAAGAAAAAAAKAAAAAAAHAPj/AAAJAAAAAAAHAPn/AAAJAAEAAAAHAPr/AAAJAAEAAAAHAPv/AAAJAAEAAAAHAPz/AAAJAAEAAAAHAP3/AAAJAAEAAAAHAP7/AAAJAAEAAAAHAP//AAAJAAEAAAAHAAAAAAAKAAEAAAAIAPj/AAAKAAAAAAAJAPj/AAAKAAAAAAAKAPj/AAAKAAAAAAALAPj/AAAKAAAAAAAMAPj/AAAKAAAAAAANAPj/AAAKAAAAAADy//f/AAALAAEAAADy//b/AAALAAEAAADy//X/AAALAAEAAADy//T/AAALAAEAAADy//P/AAALAAEAAADy//L/AAALAAEAAADy//H/AAALAAEAAADy//D/AAALAAEAAADz/+//AAAKAAIAAAD0/+//AAAKAAIAAAD1/+//AAAKAAIAAAD2/+//AAAKAAIAAAD3/+//AAAKAAIAAAD4/+//AAAKAAIAAAD5/+//AAAKAAIAAAD6/+//AAAKAAIAAAD7/+//AAAKAAIAAAD8/+//AAAKAAIAAAD9/+//AAAKAAIAAAD+/+//AAAKAAIAAAD//+//AAAKAAIAAAAAAO//AAAKAAIAAAABAO//AAAKAAIAAAACAO//AAAKAAIAAAADAO//AAAKAAIAAAAEAO//AAAKAAIAAAAFAO//AAAKAAIAAAAGAO//AAAKAAIAAAAHAO//AAAKAAIAAAAIAO//AAAKAAIAAAAJAO//AAAKAAIAAAAKAO//AAAKAAIAAAALAO//AAAKAAIAAAAMAO//AAAKAAIAAAANAO//AAAKAAIAAAAOAPD/AAAJAAEAAAAOAPH/AAAJAAEAAAAOAPL/AAAJAAEAAAAOAPP/AAAJAAEAAAAOAPT/AAAJAAEAAAAOAPX/AAAJAAEAAAAOAPb/AAAJAAEAAAAOAPf/AAAJAAEAAAA=")
tile_set = SubResource("TileSet_tlwt5")

[node name="Player" type="RigidBody2D" parent="."]
texture_filter = 1
position = Vector2(0, -6)
collision_mask = 2
mass = 0.1
physics_material_override = SubResource("PhysicsMaterial_f3sb7")
gravity_scale = 0.333
lock_rotation = true
continuous_cd = 2
script = ExtResource("2_pkg7o")

[node name="Collider" type="CollisionShape2D" parent="Player"]
position = Vector2(0, 1)
shape = SubResource("CapsuleShape2D_036b0")

[node name="Sprite" type="AnimatedSprite2D" parent="Player"]
sprite_frames = SubResource("SpriteFrames_f3sb7")
animation = &"idle"
autoplay = "idle"
frame_progress = 1.0

[node name="Crawl" type="Node" parent="Player" node_paths=PackedStringArray("_player_rb")]
script = ExtResource("2_tlwt5")
_crawl_speed = 15.0
_player_rb = NodePath("..")
action_active = true

[node name="Jump" type="Node" parent="Player" node_paths=PackedStringArray("_player_rb")]
script = ExtResource("3_036b0")
_jump_force = 25.0
_player_rb = NodePath("..")
action_active = true
metadata/_custom_type_script = "uid://btqms6rhikc4v"

[node name="WallDetector" type="Area2D" parent="Player"]
collision_layer = 0
collision_mask = 2
priority = 5
script = ExtResource("4_dwbse")

[node name="Collider" type="CollisionShape2D" parent="Player/WallDetector"]
position = Vector2(0, 1)
shape = SubResource("CircleShape2D_036b0")

[node name="Camera" type="Camera2D" parent="." node_paths=PackedStringArray("_follow_target")]
zoom = Vector2(4, 4)
position_smoothing_enabled = true
position_smoothing_speed = 2.0
script = ExtResource("4_036b0")
_follow_target = NodePath("../Player")

[node name="InputService" type="Node" parent="." node_paths=PackedStringArray("_pull_origin")]
script = ExtResource("3_aqk2v")
_pull_origin = NodePath("../Player")

[connection signal="body_entered" from="Player/WallDetector" to="Player/WallDetector" method="_on_body_entered"]
[connection signal="body_exited" from="Player/WallDetector" to="Player/WallDetector" method="_on_body_exited"]
[connection signal="hit_wall" from="Player/WallDetector" to="Player" method="on_stick"]
[connection signal="leave_wall" from="Player/WallDetector" to="Player" method="on_unstick"]
[connection signal="move_input_change" from="InputService" to="Player/Crawl" method="_on_move_input_change"]
[connection signal="pull_input_change" from="InputService" to="Player/Jump" method="_on_input_service_pull_input_change"]
[connection signal="pull_release" from="InputService" to="Player/Jump" method="_on_input_service_pull_release"]
